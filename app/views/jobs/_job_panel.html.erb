<div class="panel panel-default" id="<%= job.id %>">

<% if params[:controller] == "jobs" %>
  <span class="hidden latitude"><%= job.latitude %></span>
  <span class="hidden longitude"><%= job.longitude %></span>
<% end %>

  <div class="panel-heading">
    <h3 class="panel-title">
      <p>
        <% if current_user == job.user %>
          <% if (request.fullpath).include?('/jobs') %>
            <%= link_to job, method: :delete,
                                 data: { confirm: 'Are you sure you want to delete this post?' } do %>
              <%= fa_icon 'minus-square 2x', title: 'Delete',
                                             class: 'delete-job-post pull-right' %>
            <% end %>
          <% else %>
            <%= link_to job, method: :delete,
                             remote: true, 
                               data: { confirm: 'Are you sure you want to delete this post?' } do %>
              <%= fa_icon 'minus-square 2x', title: 'Delete',
                                             class: 'delete-job-post pull-right' %>
            <% end %>
          <% end %>            
          
          <%= link_to edit_job_path(job) do %>
            <%= fa_icon 'edit 2x', title: 'Edit', class: 'pull-right' %>
          <% end %>
        
        <% elsif contractor_signed_in? %>
          <% if (request.fullpath).include?('/contractors') %>
            <%= link_to job_path(job), class: 'hidden-xs hidden-sm btn btn-primary pull-right' do %>
              View Details
            <% end %>
          <% elsif (request.fullpath).include?('/jobs') %>
            <%= link_to "Send a comment", new_polymorphic_url([@job, Comment.new]), 
                                              class: 'btn btn-small btn-success pull-right',
                                              remote: true, 
                                               data: { toggle: 'modal',
                                                       target: '#commentModal' } %>
          <% end %>
        <% end %>
      </p>

      <%= render partial: 'jobs/job_category_panel', locals: { job: job } %>
       
    </h3>
  </div>

  <div class="panel-body">
    <% if contractor_signed_in? %>
      <div class="col-xs-12 col-sm-12 col-md-12" id="job-<%= job.id %>">
        <%= render 'bids/form', job: job %>
      </div>
    <% end %>      
    <div class="col-xs-12 col-md-6 text-center">
      <% if job.uploads.count > 0 %>
        <%= render partial: 'layouts/pic', 
                collection: job.uploads, 
                        as: :upload, 
                    locals: { owner: job.user } %>
      <% end %>

      <%= render partial: 'layouts/pic_upload_button', 
                  locals: { item: job,
                      item_owner: job.user, 
                  current_member: current_user || current_contractor,
               item_upload_count: job.uploads.count,
                     item_status: '' } %>

      <hr class="visible-xs visible-sm">
      <% if params[:controller] == "jobs" %>
        <br><br>
        <div class="map_canvas"></div>
        <br>
      <% end %>
    </div>
    <%= link_to job, class: 'unstyled-link' do %>
      <div  class="col-xs-12 col-md-6">
        <p class="lead text-center">
          <strong>
            <%= job.title %>
          </strong><br>

          <%= link_to "http://maps.google.com/?q=#{ job.address }", 
                      class: 'google_links', 
                     target: "_blank" do %>
            <%= fa_icon 'external-link', title: 'View in Google Maps' %>
            View in Google Maps
          <% end %>
        </p>
        <hr>
        <%= (request.fullpath).include?('jobs') ? 
                                job.description : 
                                truncate(job.description, length: 200) %>
      </div>                                  
    </div>
    <%= render partial: 'jobs/job_footer_panel', locals: { job: job, owner: job.user } %>
  <% end %>
</div>